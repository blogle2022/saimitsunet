<?
include("my_horo.php");
include("his_horo.php");

$horo->getAbsDegreeBySign();
$horo2->getAbsDegreeBySign();


$Sun0 = $horo->planets["Sun"]->absPosBySign;
$Sun1 = $horo2->planets["Sun"]->absPosBySign;

$Moon0 = $horo->planets["Moon"]->absPosBySign;
$Moon1 = $horo2->planets["Moon"]->absPosBySign;

$Jupiter0 = $horo->planets["Jupiter"]->absPosBySign;
$Jupiter1 = $horo2->planets["Jupiter"]->absPosBySign;

$Mars0 = $horo->planets["Mars"]->absPosBySign;
$Mars1 = $horo2->planets["Mars"]->absPosBySign;

$Venus0 = $horo->planets["Venus"]->absPosBySign;
$Venus1 = $horo2->planets["Venus"]->absPosBySign;

$Mercury0 = $horo->planets["Mercury"]->absPosBySign;
$Mercury1 = $horo2->planets["Mercury"]->absPosBySign;



include("4f_01_01");
$idx[0] = calcMatch($Sun0, $Sun1, $Moon0, $Moon1);	## ����
$idx[1] = 30 + calcMatch($Sun0, $Sun1, $Jupiter0, $Jupiter1); ##����
$idx[2] = 90 + calcMatch($Sun0, $Sun1, $Venus0, $Venus1);	## ����
$idx[3] = 120 + calcMatch($Sun0, $Sun1, $Mercury0, $Mercury1);	## ����
$idx[4] = 60 + calcMatch($Sun0, $Sun1, $Mars0, $Mars1); ## ���å���

$thisyear = intval(date("Y", time()));
$thisday = intval(date("j", time()));
$mod = ( $day + $day2 ) % 2;
if( ($thisyear-$user->year) > 18) {
	$file = "/srv/phplib/msg/4f_01a";
} else {
	$file = "/srv/phplib/msg/4f_01y";
}
$line_len = 50;
$line_cnt = 3;
$text_cnt = 13;

$hash = intval(($year + $month + $day + $hour + $min) % 16);
$fp = fopen($file, "r");

$msg[0][0] = "����";
$msg[1][0] = "��ʡ";
$msg[2][0] = "����";
$msg[3][0] = "����";
$msg[4][0] = "���å���";

for($i=0; $i<5; $i++) {
	$begin_ofs = $line_len * $text_cnt * ($idx[$i] - 1) * 2;
	for($j=0; $j<4; $j++) {
		$res++;
		##$content .= "head" . strval($res) . "=" . "�դ����������" . $titles[$i];
		##$content .= " (��" . strval($j+1) . "��)\n";
		$ofs = $line_len * (1 + $j * $line_cnt);
		if($hash & (2 ^ $j)) {
			$ofs += (1 + 4 * $line_cnt) * $line_len;
		}
		fseek($fp, ($begin_ofs + $ofs));
		$txt = "";
		for($l=0; $l<$line_cnt; $l++) {
			##$msg[$i][] = stripLine(fgets($fp, 1024));
			$txt .= stripLine(fgets($fp, 1024));
		}
		$msg[$i][$j+1] = $txt;
		##$content .= "text" . strval($res) . "=";
		##$content .= $txt . "\n";
	}
}
fclose($fp);
##print_r($idx);
##print_r($msg);




?>
							<td align="center" valign="top" bgcolor="#ffffff"><img src="../images/rtop.gif" alt="" width="535" height="22" border="0"><br>
<font size="+2" color="#ffccff">������</font><font size="+2">��</font><font size="+2" color="gray">��ͤ����ʰ����ԡˡ�</font><font size="+2" color="#ffccff">������<br>
<hr size="3" width="92%">
<table width="500" border="0" cellspacing="3" cellpadding="8">
<tr>

<td align="center">
<?
include("my_horographic.php");
?>
</td>

</tr>
<tr><td>
<table width="100%" border="0" cellspacing="10" cellpadding="0">
<?
for($i=0; $i<5; $i++) {
?>
<tr height="25"><td align="center" bgcolor="#ffccff">
<!--
<? echo $idx[$i]; ?>
-->
<?
echo $msg[$i][0];
?>
</td></tr>
<tr><td>
<?
	for($l=1; $l<=3; $l++) {
		echo $msg[$i][$l];
	}
?>
</td></tr>
<?
}
?>
</table>


</td>
</tr>



</table>
</font><font size="+3" color="gray">
									<hr size="3" width="92%">
								</font>
<p><img src="../images/runder.gif" alt="" width="535" height="22" border="0"></p>
</td>
