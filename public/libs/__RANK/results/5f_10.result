<?
include("my_horo.php");
$horo->getAbsDegreeBySign();

$datestr = array(
	"7��1��","7��8��","7��15��","7��21��","7��29��",
	"8��5��","8��12��","8��19��","8��26��",
	"9��2��","9��9��","9��16��","9��23��","9��30��",
	"10��7��","10��14��","10��21��","10��28��",
	"11��4��","11��11��","11��18��","11��25��",
	"12��2��","12��9��","12��16��","12��23��","12��30��");


$tran["Jupiter"] = array(
	219.025270944444,218.981693333333,219.085351194444,
	219.332876222222,219.720925194444,220.243080638889,
	220.891400361111,221.657346944444,222.533569277778,
	223.511358833333,224.581387333333,225.734883194444,
	227.328316027778,228.261410833333,229.617420166667,
	231.024488194444,232.475522166667,233.963131638889,
	235.478846222222,237.015478638889,238.566016527778,
	240.123181111111,241.678469027778,243.224527944444,
	244.753844833333,246.258819222222);
$tran["Mars"] = array(
	136.395822333333,140.696888,145.016111166667,
	149.355494388889,153.716990194444,158.099615222222,
	162.503572611111,166.931141388889,171.384604361111,
	175.863604138889,180.368140027778,184.9004655,
	190.771977916667,194.055457833333,198.677666333333,
	203.331515416667,208.019192777778,212.740608277778,
	217.494997805556,222.283673166667,227.108454277778,
	231.969469111111,236.864809166667,241.795303944444,
	246.762259083333,251.765680083333);
$tran["Sun"] = array(
	98.8087104444444,105.482243166667,112.154988388889,
	118.834264444444,125.522989138889,132.21969525,
	138.926695944444,145.650971083333,152.396123416667,
	159.160464611111,165.944103861111,172.752656694444,
	181.548346722222,186.453661083333,193.341621527778,
	200.257079083333,207.203348027778,214.177862888889,
	221.175667583333,228.197229083333,235.244894888889,
	242.315866583333,249.403030777778,256.504023222222,
	263.619992777778,270.748524277778);
$tran["Venus"] = array(
	68.0033592222222,76.3612286111111,84.7528674444444,
	93.1802398888889,101.641849555556,110.134937027778,
	118.660083083333,127.219247722222,135.811063305556,
	144.431544083333,153.078357861111,161.751674722222,
	172.938530888889,179.167320805556,187.900446222222,
	196.648022166667,205.408929722222,214.179615861111,
	222.955568416667,231.735907638889,240.521183222222,
	249.310024944444,258.098481,266.885394055556,
	275.671607333333,284.456886694444);
$natal["Sun"] = $horo->planets["Sun"]->absPosBySign;
$natal["Jupiter"] = $horo->planets["Jupiter"]->absPosBySign;
$natal["Saturn"] = $horo->planets["Saturn"]->absPosBySign;
$natal["Venus"] = $horo->planets["Venus"]->absPosBySign;


$asps = array(0,60,90,120,180);
$orbs = array(
	"Jupiter" => 5,
	"Mars" => 5,
	"Venus" => 7,
	"Sun" => 7);

$bplnts = array("Sun","Jupiter","Saturn","Venus");
$cplnts = array("Jupiter","Mars","Venus","Sun");
$starts = array(
	"Sun" => 1,
	"Jupiter" => 2,
	"Saturn" => 3,
	"Venus" => 4);
$lucky = array("", "", "", "", "");

foreach ($bplnts as $bplnt) {
	$basp = $natal["$bplnt"];
	$mindiff = 180;
	$idx = $starts["$bplnt"];
	foreach ($cplnts as $cplnt) {
		$orb = $orbs["$cplnt"];
		foreach ($asps as $asp) {
			for($i=0; $i<26; $i++) {
				$tasp = $tran["$cplnt"][$i];

				$width = abs($basp - $tasp);
				$dif = abs($width - $asp);
				if($dif < $mindiff) {
					$mindiff = $dif;
					$textidx["$starts[$bplnt]"] = $idx;
				}
			}
			$idx += 4;
		}

	}
}

$lasps = array(120,60,0);
$lcplnts = array("Jupiter", "Venus", "Sun");

foreach ($bplnts as $bplnt) {
	$basp = $natal["$bplnt"];
	foreach ($lcplnts as $cplnt) {
		if(strcmp($lucky["$starts[$bplnt]"],"")!=0) break;
		$orb = $orbs["$cplnt"];
		foreach ($lasps as $asp) {
			if(strcmp($lucky["$starts[$bplnt]"],"")!=0) break;
			for($i=0; $i<26; $i++) {
				$tasp = $tran["$cplnt"][$i];
				if(hasAspect($basp,$tasp,$asp,$orb)) {
					$lucky["$starts[$bplnt]"] = strval($i);
					break;
				}
			}
		}
	}
}

	$mod = intval($day) % 16;
	$fp = fopen("/srv/phplib/msg/ft2006b.txt","r");
	for($j=0; $j<4; $j++) { ### Sun,Jupiter,Saturn,Venus
		$firstpos = ( $textidx[$j+1] - 1 ) * 40;

		for($k=0; $k<4; $k++) {
			$mixpos[$k] = $firstpos + $k * 5;
			if( ($mod & (2 ^ $k)) > 0 ) $mixpos[$k] += 20;
			##echo "$mixpos[$k], ";
			fseek($fp, ($mixpos[$k] + 1) * 56);
			$text[$j] .= stripLine(fread($fp, 56 * 4));
		}
		$lucky_idx = $lucky[$j+1];
		$text[$j] = ereg_replace("\*\*��\*\*��",$datestr[$lucky_idx],$text[$j]);

	}
	fclose($fp);

##print_r($text);
?>
							<td align="center" valign="top" bgcolor="#ffffff"><img src="../images/rtop.gif" alt="" width="535" height="22" border="0"><br>
<font size="+2" color="#ffccff">������</font><font size="+2">��</font><font size="+2" color="gray">2006ǯ��Ⱦ�α�����</font><font size="+2" color="#ffccff">������<br>
<hr size="3" width="92%">
<table width="500" border="0" cellspacing="3" cellpadding="8">
<tr>

<td align="center">
<?
include("my_horographic.php");
?>
</td>

</tr>


<tr><td>
<table width="100%" border="0" cellspacing="10" cellpadding="0">
<tr height="25"><td align="center" bgcolor="#ffccff">
�����������ۤǤߤ����ܱ�
</td></tr>
<tr><td>
<?
echo $text[0];
?>
</td></tr>
<tr height="25"><td align="center" bgcolor="#ffccff">
�������������Ǥߤ�����
</td></tr>
<tr><td>
<?
echo $text[1];
?>
</td></tr>
<tr height="25"><td align="center" bgcolor="#ffccff">
�������������Ǥߤ�����
</td></tr>
<tr><td>
<?
echo $text[2];
?>
</td></tr>
<tr height="25"><td align="center" bgcolor="#ffccff">
�������ζ����Ǥߤ���ֱ�
</td></tr>
<tr><td>
<?
echo $text[3];
?>
</td></tr>
</table>


</td>
</tr>



</table>
</font><font size="+3" color="gray">
									<hr size="3" width="92%">
								</font>
<p><img src="../images/runder.gif" alt="" width="535" height="22" border="0"></p>
</td>
